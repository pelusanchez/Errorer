"use strict";var INITIAL_ROWS=3;var tableElement;var table_total_rows=0;var xPos=0;var yPos=0;var VALORES=new Array(300);var defaultError=0;var mValue=1;var DEBUG=true;var AllowedKeyCodes=[8,198,190,9,189,122,27,116];var AllowedKeys=["Backspace",",","."];var LatexTEMPLATE={inicio_a:"\\begin{tabular}{|c|c|c|}\n\\hline\n$x_i$ & $y_i$ & $\\Delta y_i$\\\\\n\\hline\n\\hline\n",fin:"\\hline\n\\end{tabular}",inicio_b_a:"\\begin{tabular}{|c|c|c|c|c|c|}\n\\hline\n\t$x_i^m$\t&\t$x_i^{2m}$\t&\t",inicio_b_b:"$y_ix_i^m$\t&\t$|x_i^m|$\t&\t$|x_i^m|\\Delta y_i$\\\\\n \\hline\n\\hline\n"};window.onload=function(){tableElement=document.getElementById("main_table");for(var a=0;a<INITIAL_ROWS;a++){addRow()}document.getElementById("c_0_r_0").select();document.body.onkeydown=function(d){var b=false;var c;for(c in AllowedKeyCodes){if(d.keyCode==AllowedKeyCodes[c]){b=true;break}}if(!b){for(c in AllowedKeys){if(d.key==AllowedKeys[c]){b=true;break}}}if(!isNaN(d.key)||b){}else{switch(d.keyCode){case 37:irIzquierda();break;case 38:irArriba();break;case 39:irDerecha();break;case 40:irAbajo();break;case 69:setDefaultError();break;case 65:ajuste();break;case 77:setExponent();break;case 13:computeValues();break;default:if(DEBUG){console.log(d.keyCode)}break}d.preventDefault()}}};var addRow=function(){if(tableElement){var e="<tr>";var f=tableElement.insertRow(table_total_rows+1);f.setAttribute("id","row_"+(table_total_rows+1));var c=f.insertCell(0);var b=f.insertCell(1);var a=f.insertCell(2);c.innerHTML='<td><input type="text" id="c_0_r_'+table_total_rows+'" onfocus="selectiona(this.id)" oninput="textChanged(this)"></input>';b.innerHTML='<td><input type="text" id="c_1_r_'+table_total_rows+'" onfocus="selectiona(this.id)" oninput="textChanged(this)"></input>';a.innerHTML='<td><input type="text" id="c_2_r_'+table_total_rows+'" onfocus="selectiona(this.id)" oninput="textChanged(this)"></input>';f.insertCell(3).setAttribute("class","black");for(var d=4;d<=8;d++){f.insertCell(d).setAttribute("id","fila_"+(table_total_rows)+"_columna_"+d)}table_total_rows++}};function irIzquierda(){if(xPos>0&&xPos<=2){xPos--}updatePosition()}function irArriba(){if(yPos>0&&yPos<=table_total_rows){yPos--}updatePosition()}function irDerecha(){if(xPos>=0&&xPos<2){xPos++}updatePosition()}function irAbajo(){if(yPos>=0&&yPos<table_total_rows-1){yPos++}else{addRow();yPos++}updatePosition()}function updatePosition(){if(DEBUG){console.log("c_"+xPos+"_r_"+yPos)}document.getElementById("c_"+xPos+"_r_"+yPos).select()}function selectiona(b){var a=b.replace("c_","").replace("_r_","X").split("X");xPos=parseInt(a[0]);yPos=parseInt(a[1])}function textChanged(a){}var setDefaultError=function(){if(document.getElementById("c_2_r_0").value&&document.getElementById("c_2_r_0").value!==undefined&&document.getElementById("c_2_r_0").value!=""&&defaultError==0){defaultError=document.getElementById("c_2_r_0").value}fillDefaultError()};var fillDefaultError=function(){for(var a=0;a<table_total_rows;a++){document.getElementById("c_2_r_"+a).value=defaultError}};var addValueToRow=function(a,c,b){if(tableElement){if(DEBUG){console.log("fila_"+c+"_columna_"+a)}document.getElementById("fila_"+c+"_columna_"+a).innerHTML=b}};var computeValues=function(){var a,d,c,e;for(var b=0;b<table_total_rows;b++){a=parseFloat(parseNumber(document.getElementById("c_0_r_"+b).value));d=parseFloat(parseNumber(document.getElementById("c_1_r_"+b).value));c=parseFloat(parseNumber(document.getElementById("c_2_r_"+b).value));e=Math.pow(a,mValue);if(isNaN(a)||isNaN(d)||isNaN(c)){addValueToRow(4,b,"");addValueToRow(5,b,"");addValueToRow(6,b,"");addValueToRow(7,b,"");addValueToRow(8,b,"")}else{addValueToRow(4,b,redondear(e));addValueToRow(5,b,redondear(Math.abs(e)));addValueToRow(6,b,redondear(e*e));addValueToRow(7,b,redondear(d*Math.pow(a,mValue)));addValueToRow(8,b,redondear(Math.abs(e)*c))}}};function setExponent(){mValue=parseFloat(parseNumber(prompt("Valor para el exponente (por defecto, m=1)")));if(mValue==0){mValue=1}document.getElementById("footer_info_exp").innerHTML=mValue;document.getElementById("footer_info_ajuste").innerHTML="ax<sup>"+mValue+"</sup>";computeValues()}function setYError(){defaultError=parseFloat(prompt("Error para la y:"));fillDefaultError();computeValues()}function createLatexA(){var e=LatexTEMPLATE.inicio_a;var a,d,c;for(var b=0;b<table_total_rows;b++){a=parseFloat(parseNumber(document.getElementById("c_0_r_"+b).value));d=parseFloat(parseNumber(document.getElementById("c_1_r_"+b).value));c=parseFloat(parseNumber(document.getElementById("c_2_r_"+b).value));if(isNaN(a)){a=""}if(isNaN(d)){d=""}if(isNaN(c)){c=""}e+=a+"\t&\t"+d+"\t&\t"+c+"\\\\ \n"}e+=LatexTEMPLATE.fin;writeXportTool(e)}function createLatexB(){var n=LatexTEMPLATE.inicio_b_a;n+=LatexTEMPLATE.inicio_b_b;var h,g,o,m,l,k;for(var j=0;j<table_total_rows;j++){for(var g=4;g<=8;g++){h=parseFloat(document.getElementById("fila_"+j+"_columna_"+g).innerHTML);if(isNaN(h)){h=""}n+="\t"+h+"\t";if(g<8){n+="&"}}n+="\\\\\n"}n+=LatexTEMPLATE.fin;writeXportTool(n)}function closeXportTool(){document.getElementById("XportTool").style.display="none"}function writeXportTool(a){document.getElementById("textXportTool").innerHTML=a.replace(/\n/g,"<br>");document.getElementById("XportTool").style.display="block"}var redondear=function(a){return parseFloat(Math.round(a*10000000)/10000000)};var ajuste=function(){computeValues();var j='<div class="text_center"><span class="mini_title">=== RESULTADO DEL AJUSTE ===</span>\n';var p=0;var f=0;var k=0;var s=0;var r=0;var q="";var g="";var b="";var o,n,l,m=0;for(var h=0;h<table_total_rows;h++){o=parseFloat(document.getElementById("fila_"+h+"_columna_6").innerHTML);n=parseFloat(document.getElementById("fila_"+h+"_columna_7").innerHTML);l=parseFloat(document.getElementById("fila_"+h+"_columna_8").innerHTML);if(!isNaN(o)&&!isNaN(n)&&!isNaN(l)){f+=n;k+=o;r+=l;q+=n;g+=o;b+=l;m++;if(h<table_total_rows-1){q+="+";g+="+";b+="+"}}}p=f/k;s=r/k;document.getElementById("footer_info_a").innerHTML=p;document.getElementById("footer_info_da").innerHTML=s;j+="Ajuste: : y=ax<sup>"+mValue+"</sup>\n";j+="a = "+redondear(p)+"\n";j+="&Delta;a = "+s+"\n\n";j+='<span class="mini_title">=== SUMA ===</span>\n';j+="a = ("+q+")/("+g+")\n";j+="&Delta;a = ("+b+")/("+g+")\n\n";j+='<span class="mini_title">=== LATEX ===</span>\n';j+="a = \\frac{\\sum_{1}^{"+m+"} "+q+"}{\\sum_{1}^{"+m+"} "+g+"}\n";j+="&Delta;a = \\frac{\\sum_{1}^{"+m+"} "+b+"}{\\sum_{1}^{"+m+"} "+g+"}\n";j+="</div>";writeXportTool(j)};var rellenar=function(d){var c=redondear(parseFloat(parseNumber(prompt("Valor inicial:"))));var f=redondear(parseFloat(parseNumber(prompt("Valor final:"))));var h=redondear(parseFloat(parseNumber(prompt("Incremento:"))));var b=0;var g=9999;if(h==0){alert("Eso no posible es:/ Incremento de cero...");return 0}if(c==f){alert("Eso no posible es:/ Inicial y final iguales...");return 0}if(c>f){if(h<0){h=-h}for(var e=c;e>=f;e-=h){if(b>=table_total_rows){addRow()}document.getElementById("c_"+d+"_r_"+b).value=redondear(e);b++;if(b>=g){return 0}}}if(c<f){if(h<0){h=-h}for(var e=c;e<=f;e+=h){if(b>=table_total_rows){addRow()}document.getElementById("c_"+d+"_r_"+b).value=redondear(e);b++;if(b>=g){return 0}}}};var parseNumber=function(a){return a.replace(/,/g,".")};var aiudaa=function(){var a="=== AYUDA! ===\nPara introducir valores, selecione una fila y una columna e introduzca el valor. Puede moverse a trav&eacute;s de la tabla utilizando las flechas. Las filas se a&ntilde;aden autom&aacute;ticamente. Para generar los valores de las columnas de la derecha, pulse ENTER o clicar en AJUSTE.\n\n=== CAMBIAR PAR&Aacute;METROS ===\nPara cambiar el valor del exponente (llamado m), pulsar CAMBIAR M en el men&uacute;.Para cambiar el valor del error en y, pulsar [Error en y].\n\n=== INFORMACI&Oacute;N SOBRE RELLENO ===\nSi los valores de x<sub>i</sub>, y<sub>i</sub> o &Delta;y<sub>i</sub> son una serie (por ejemplo, los valores de x<sub>i</sub> son 2 4 6 8 10 ...), pulse RELLENAR: [x<sub>i</sub>, y<sub>i</sub>, &Delta;y<sub>i</sub>] seg&uacute;n corresponda e introduzca el valor inicial (en el ejemplo, el 2), el valor final, y el incremento(en el ejemplo, 2).";writeXportTool(a)};function grafika(){var b=document.createElement("canvas");b.setAttribute("id","graphikaCanvas");b.setAttribute("width","600");b.setAttribute("height","400");var a=b.getContext("2d");a.beginPath();a.fillRect(10,10,1,1);a.stroke();document.getElementById("textXportTool").appendChild(b);document.getElementById("XportTool").style.display="block"}function openData(){}function saveData(){var d="";var a,e,c;for(var b=0;b<table_total_rows;b++){a=parseFloat(parseNumber(document.getElementById("c_0_r_"+b).value));e=parseFloat(parseNumber(document.getElementById("c_1_r_"+b).value));c=parseFloat(parseNumber(document.getElementById("c_2_r_"+b).value));if(isNaN(a)){a=""}if(isNaN(e)){e=""}if(isNaN(c)){c=""}d+=a+","+e+","+c+"\n"}downloadData(d)}var downloadData=function(d){if(typeof window.Blob!=undefined){var c=new Blob([d],{type:"text/plain"});var e=URL.createObjectURL(c);var b=document.createElement("a");b.href=e;b.download="datos.txt";document.body.appendChild(b);b.click()}else{alert("FunciÃ³n no soportada por tu navegador...")}};window.onbeforeunload=function(){if(!DEBUG){return"Desea salir?"}};